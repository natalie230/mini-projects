---
title: "britishbakeof"
author: "Natalie"
date: "2022-11-01"
output: html_document
---

```{r, include=FALSE}
# install.packages("bakeoff") # uncomment to install 
library(tidyverse)
library(bakeoff)
library(ggplot2)
library(dplyr)
```

1. Introduction to the dataset

`bakeoff` contain information on the show, Great British Bakeoff(GBBO). There are mainly 4 datasets, `ratings`,`bakers`, `challenges` and `episodes` to explore.  I will performing some exploratory data analysis on the datasets to gather insights. 

More information on the show can be found on: https://en.wikipedia.org/wiki/The_Great_British_Bake_Off


2. Plot 1
```{r, echo=FALSE}
data_df <- ratings%>%
  select(c(1:2,4)) %>%
  rename(v7=viewers_7day)

series_df <- group_by(data_df, series) %>% # for series labels 
  filter(episode==max(episode))
series_df[10,2] <- 10.2 # to prevent overlap between labels for series 8 & 10

ggplot(data_df, aes(episode, v7, 
                    col=as.factor(series))) + # make series a discrete variable
  geom_line(show.legend=FALSE) +
  geom_point(col="black", size=0.3) +
  scale_x_continuous(breaks=c(1:10)) +
  scale_y_continuous(breaks=c(seq(2, 16, by=2))) +
  geom_text(data=series_df, aes(episode, v7, label=series),
            hjust="left", nudge_x=0.1, size=2, show.legend=FALSE) +
  labs(y="Viewer Numbers in Millions", 
       x="Episode", title="GBBO Viewer Numbers in Millions over Episodes of each UK Series") +
  annotate("text", 10, 16.5, label="Series", 
           size=2, hjust="left") +
  theme(title=element_text(size=9), 
        axis.title=element_text(size=7), 
        axis.text=element_text(size=6))
```


The plot above showcases 7 day Viewer numbers in all 10 UK series of GBBO. The first insight is there is a general increasing trend in the `Viewer numbers` over the `Episodes` across all `Series`, with a significant rise between the second last and the last Episodes in all except Series 1. Additionally, it is easy to spot points where the `Viewer Numbers` increase significantly, noticeably in Series 5, Episode 4 and 9. 

I chose a line geom to link each Episode of a Series together since each Episode reflects the time passed. Connecting each point will help visualise the trend between each point, whether or not the `Viewer numbers` increased or decreased. I added a point geom to denote the actual data points. 

Also, `Series` is mapped to the `colour` aesthetics to differentiate each line by its `Series` easily. I labelled the `Series` within the graph to maximise data-ink ratio and save time from having to cross refer to a legend and the lines. 

This plot would be appropriate for the Production staff of the GBBO to analyse their ratings across the `Series`. The plot is not too technical with a simple scale, so that anyone without Data Analytics background can read the plot with ease. The plot has actual data points plotted so the reader can use the points to calculate actual viewer percentages. 

Also, the staff can identify episodes with high viewer numbers to identify the participants with high popularity to possibly invite for future show again to achieve higher ratings. 

3. Plot 2
```{r, include=FALSE}
range_fn <- function(x){
  x <- as.integer(x/10) # to round off any dp of 100 aka 100.0/100.0000
  ifelse(x==10, "90-100", paste(as.character(x*10), as.character((x+1)*10), sep="-")) # use ifelse to force x as each ele instead 1 whole vec of all col vals
}

# data_df2 <- bakers %>%
#   select(c(1, 17, 20)) %>%
#   mutate(age_range=age_fn(age), .after=series) %>%
#   group_by(age_range, series) %>%
#   mutate(ave_pct=mean(percent_episodes_appeared), .after=series)

data_df2 <- bakers %>%
  select(c(1, 17, 20)) %>%
  mutate(pct_range=range_fn(percent_episodes_appeared), .after=series) %>%
  group_by(pct_range, series) %>%
  mutate(ave_pct=mean(age), .after=series)

ggplot(data_df2) +
  geom_tile(aes(percent_episodes_appeared, series, fill=age)) +
  scale_y_continuous(breaks=c(1:10))

# ggplot(data_df2) +
#   geom_tile(aes(age_range, series, fill=percent_episodes_appeared)) +
#   scale_y_continuous(breaks=c(1:10))
#   #geom_point(position="jitter", alpha=0.6) #+
#   #scale_colour_brewer(palette="Blues")
```
```{r}
data_df2 <- select(bakers, c(series, percent_episodes_appeared, age)) %>%
  mutate(age_range=range_fn(age)) %>%
  group_by(series, age_range) %>% #expect 10*10grps?
  mutate(mean_pct=mean(percent_episodes_appeared)) %>%
  select(series, age_range, mean_pct) %>%
  unique()

# add missing age_range for each series
tmp_df <- data.frame(c(rep(1,3),rep(2,2),rep(3,2),rep(4,3),rep(5,3),6,rep(7,3),8,rep(9,2),rep(10,3)), sapply(c(10,60,70,50,70,10,70,10,40,70,20,50,70,70,10,50,70,60,10,70,10,60,70), range_fn),integer(7*10-NROW(data_df2)))
colnames(tmp_df) <- colnames(data_df2)

data_df3 <- bind_rows(data_df2, tmp_df) %>% 
  arrange(series, age_range, .by_group=TRUE)

ggplot(data_df3) +
  geom_col(aes(mean_pct, as.factor(series), fill=age_range), position=position_dodge(width=3), show.legend=TRUE) +
  scale_fill_brewer() +
  labs(title="Mean Percentage of Episodes appeared for each Series across each Age Range",
       y="Series", x="Mean Percentage of Episodes appeared(%)") +
  theme(plot.title=element_text(size=8.5,hjust=0.2), axis.title=element_text(size=6), legend.title=element_text(size=5), legend.text=element_text(size=5), axis.ticks=element_line(size=0.5))
  # geom_text(aes(mean_pct, as.factor(series), label=age_range), nudge_x=0.1, size=2, show.legend=FALSE) #+
  #theme(legend.position="None") +
  #facet_wrap(~series,nrow=5) 

# tried to add the geom text of age range to the right of every bar to remove legend but did not work
```


From the column graph, we can tell that most of the winners are younger as the longest columns are mostly of light shades of blue, implying those younger were in the show for a longer period of time across `Series` 1 to 10.

Also, we can also tell across the 10 Series, the length of all the columns are decreasing. This shows that the there is some increase in diversity of ages across all `Episodes` in the recent `Series`.

I chose a horizontal column graph so the reader can easily compare the percentage of episodes appeared in according to the length of the columns. By mapping the fill aesthetic to the `age_range` and y aesthetic to `Series`, we can zoom in on each Series and and see the overview of all. The discrete colour palette helps user to make links between the colour shades and age. The older the participants, the darker the colour of the column representing them. 

This plot would be most appropriate for layman audience as it is a simple bar chart that is easy to read.

